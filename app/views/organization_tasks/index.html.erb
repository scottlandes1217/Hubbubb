<% content_for :navbar do %>
  <%= render 'shared/navbar_org' %>
<% end %>

<div data-controller="organization-tasks-index list-view">
  <%= render 'shared/list_view',
      organization: @organization,
      object_type: 'Task',
      object_id: nil,
      records: @tasks,
      new_record_path: new_organization_task_path(@organization),
      record_path_proc: ->(task) { edit_organization_task_path(@organization, task) },
      columns: @columns,
      current_view: @current_view,
      custom_actions: ->(record) {
        task = record
        capture do
          %>
          <!-- Complete button -->
          <% unless task.status == "Completed" %>
            <%= button_to "Complete", 
                organization_task_path(@organization, task),
                method: :patch,
                params: { task: { status: "Completed", completed_at: Time.current } },
                class: "btn btn-success btn-sm",
                form: { data: { turbo_confirm: "Mark this task as completed?" } } %>
          <% end %>
          
          <!-- Delete button -->
          <%= link_to "Delete", organization_task_path(@organization, task), 
                      data: { turbo_method: "delete", turbo_confirm: "Are you sure you want to delete this task?" }, 
                      class: "btn btn-danger btn-sm" %>
          <%
        end
      } %>
</div> 